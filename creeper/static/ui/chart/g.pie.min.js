(function(){function A(K,I,R,Q,S,U){U=U||{};var Z=this,C=[],G=K.set(),Y=K.set(),P=K.set(),M=[],E=S.length,L=0,V=0,O=0,W=9,T=true;function J(j,h,b,o,c,d){var i=Math.PI/180,e=j+b*Math.cos(-o*i),g=j+b*Math.cos(-c*i),l=j+b/2*Math.cos(-(o+(c-o)/2)*i),f=h+b*Math.sin(-o*i),k=h+b*Math.sin(-c*i),m=h+b/2*Math.sin(-(o+(c-o)/2)*i),n=["M",j,h,"L",e,f,"A",b,b,0,+(Math.abs(c-o)>180),1,g,k,"z"];n.middle={x:l,y:m};return n}Y.covers=G;if(E==1){P.push(K.circle(I,R,Q).attr({fill:Z.colors[0],stroke:U.stroke||"#fff","stroke-width":U.strokewidth==null?1:U.strokewidth}));G.push(K.circle(I,R,Q).attr(Z.shim));V=S[0];S[0]={value:S[0],order:0,valueOf:function(){return this.value}};P[0].middle={x:I,y:R};P[0].mangle=180}else{for(var X=0;X<E;X++){V+=S[X];S[X]={value:S[X],order:X,valueOf:function(){return this.value}}}S.sort(function(d,c){return c.value-d.value});for(X=0;X<E;X++){if(T&&S[X]*360/V<=1.5){W=X;T=false}if(X>W){T=false;S[W].value+=S[X];S[W].others=true;O=S[W].value}}E=Math.min(W+1,S.length);O&&S.splice(E)&&(S[W].others=true);for(X=0;X<E;X++){var F=L-360*S[X]/V/2;if(!X){L=90-F;F=L-360*S[X]/V/2}if(U.init){var H=J(I,R,1,L,L-360*S[X]/V).join(",")}var N=J(I,R,Q,L,L-=360*S[X]/V);var D=K.path(U.init?H:N).attr({fill:U.colors&&U.colors[X]||Z.colors[X]||"#666",stroke:U.stroke||"#fff","stroke-width":(U.strokewidth==null?1:U.strokewidth),"stroke-linejoin":"round"});D.value=S[X];D.middle=N.middle;D.mangle=F;C.push(D);P.push(D);U.init&&D.animate({path:N.join(",")},(+U.init-1)||1000,">")}for(X=0;X<E;X++){D=K.path(C[X].attr("path")).attr(Z.shim);U.href&&U.href[X]&&D.attr({href:U.href[X]});D.attr=function(){};G.push(D);P.push(D)}}Y.hover=function(b,e){e=e||function(){};var d=this;for(var c=0;c<E;c++){(function(f,h,i){var g={sector:f,cover:h,cx:I,cy:R,mx:f.middle.x,my:f.middle.y,mangle:f.mangle,r:Q,value:S[i],total:V,label:d.labels&&d.labels[i]};h.mouseover(function(){b.call(g)}).mouseout(function(){e.call(g)})})(P[c],G[c],c)}return this};Y.each=function(d){var c=this;for(var b=0;b<E;b++){(function(e,g,h){var f={sector:e,cover:g,cx:I,cy:R,x:e.middle.x,y:e.middle.y,mangle:e.mangle,r:Q,value:S[h],total:V,label:c.labels&&c.labels[h]};d.call(f)})(P[b],G[b],b)}return this};Y.click=function(d){var c=this;for(var b=0;b<E;b++){(function(e,g,h){var f={sector:e,cover:g,cx:I,cy:R,mx:e.middle.x,my:e.middle.y,mangle:e.mangle,r:Q,value:S[h],total:V,label:c.labels&&c.labels[h]};g.click(function(){d.call(f)})})(P[b],G[b],b)}return this};Y.inject=function(b){b.insertBefore(G[0])};var a=function(q,l,b,c){var n=I+Q+Q/5,o=R,g=o+10;q=q||[];c=(c&&c.toLowerCase&&c.toLowerCase())||"east";b=K[b&&b.toLowerCase()]||"circle";Y.labels=K.set();for(var k=0;k<E;k++){var f=P[k].attr("fill"),e=S[k].order,p;S[k].others&&(q[e]=l||"Others");q[e]=Z.labelise(q[e],S[k],V);Y.labels.push(K.set());Y.labels[k].push(K[b](n+5,g,5).attr({fill:f,stroke:"none"}));Y.labels[k].push(p=K.text(n+20,g,q[e]||S[e]).attr(Z.txtattr).attr({fill:U.legendcolor||"#000","text-anchor":"start"}));G[k].label=Y.labels[k];g+=p.getBBox().height*1.2}var m=Y.labels.getBBox(),d={east:[0,-m.height/2],west:[-m.width-2*Q-20,-m.height/2],north:[-Q-m.width/2,-Q-m.height-10],south:[-Q-m.width/2,Q+10]}[c];Y.labels.translate.apply(Y.labels,d);Y.push(Y.labels)};if(U.legend){a(U.legend,U.legendothers,U.legendmark,U.legendpos)}Y.push(P,G);Y.series=P;Y.covers=G;return Y}var B=function(){};B.prototype=Raphael.g;A.prototype=new B;Raphael.fn.piechart=function(G,C,D,F,E){return new A(this,G,C,D,F,E)}})();