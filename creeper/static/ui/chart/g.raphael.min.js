/*
 * g.Raphael 0.5 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.el.popup=function(F,E,H,I){var G=this.paper||this[0].paper,B,D,A,J,C;if(!G){return}switch(this.type){case"text":case"circle":case"ellipse":A=true;break;default:A=false}F=F==null?"up":F;E=E||5;B=this.getBBox();H=typeof H=="number"?H:(A?B.x+B.width/2:B.x);I=typeof I=="number"?I:(A?B.y+B.height/2:B.y);J=Math.max(B.width/2-E,0);C=Math.max(B.height/2-E,0);this.translate(H-B.x-(A?B.width/2:0),I-B.y-(A?B.height/2:0));B=this.getBBox();var K={up:["M",H,I,"l",-E,-E,-J,0,"a",E,E,0,0,1,-E,-E,"l",0,-B.height,"a",E,E,0,0,1,E,-E,"l",E*2+J*2,0,"a",E,E,0,0,1,E,E,"l",0,B.height,"a",E,E,0,0,1,-E,E,"l",-J,0,"z"].join(","),down:["M",H,I,"l",E,E,J,0,"a",E,E,0,0,1,E,E,"l",0,B.height,"a",E,E,0,0,1,-E,E,"l",-(E*2+J*2),0,"a",E,E,0,0,1,-E,-E,"l",0,-B.height,"a",E,E,0,0,1,E,-E,"l",J,0,"z"].join(","),left:["M",H,I,"l",-E,E,0,C,"a",E,E,0,0,1,-E,E,"l",-B.width,0,"a",E,E,0,0,1,-E,-E,"l",0,-(E*2+C*2),"a",E,E,0,0,1,E,-E,"l",B.width,0,"a",E,E,0,0,1,E,E,"l",0,C,"z"].join(","),right:["M",H,I,"l",E,-E,0,-C,"a",E,E,0,0,1,E,-E,"l",B.width,0,"a",E,E,0,0,1,E,E,"l",0,E*2+C*2,"a",E,E,0,0,1,-E,E,"l",-B.width,0,"a",E,E,0,0,1,-E,-E,"l",0,-C,"z"].join(",")};D={up:{x:-!A*(B.width/2),y:-E*2-(A?B.height/2:B.height)},down:{x:-!A*(B.width/2),y:E*2+(A?B.height/2:B.height)},left:{x:-E*2-(A?B.width/2:B.width),y:-!A*(B.height/2)},right:{x:E*2+(A?B.width/2:B.width),y:-!A*(B.height/2)}}[F];this.translate(D.x,D.y);return G.path(K[F]).attr({fill:"#000",stroke:"none"}).insertBefore(this.node?this:this[0])};Raphael.el.tag=function(H,A,I,J){var L=3,G=this.paper||this[0].paper;if(!G){return}var B=G.path().attr({fill:"#000",stroke:"#000"}),C=this.getBBox(),F,K,D,E;switch(this.type){case"text":case"circle":case"ellipse":D=true;break;default:D=false}H=H||0;I=typeof I=="number"?I:(D?C.x+C.width/2:C.x);J=typeof J=="number"?J:(D?C.y+C.height/2:C.y);A=A==null?5:A;K=0.5522*A;if(C.height>=A*2){B.attr({path:["M",I,J+A,"a",A,A,0,1,1,0,-A*2,A,A,0,1,1,0,A*2,"m",0,-A*2-L,"a",A+L,A+L,0,1,0,0,(A+L)*2,"L",I+A+L,J+C.height/2+L,"l",C.width+2*L,0,0,-C.height-2*L,-C.width-2*L,0,"L",I,J-A-L].join(",")})}else{F=Math.sqrt(Math.pow(A+L,2)-Math.pow(C.height/2+L,2));B.attr({path:["M",I,J+A,"c",-K,0,-A,K-A,-A,-A,0,-K,A-K,-A,A,-A,K,0,A,A-K,A,A,0,K,K-A,A,-A,A,"M",I+F,J-C.height/2-L,"a",A+L,A+L,0,1,0,0,C.height+2*L,"l",A+L-F+C.width+2*L,0,0,-C.height-2*L,"L",I+F,J-C.height/2-L].join(",")})}H=360-H;B.rotate(H,I,J);if(this.attrs){this.attr(this.attrs.x?"x":"cx",I+A+L+(!D?this.type=="text"?C.width:0:C.width/2)).attr("y",D?J:J-C.height/2);this.rotate(H,I,J);H>90&&H<270&&this.attr(this.attrs.x?"x":"cx",I-A-L-(!D?C.width:C.width/2)).rotate(180,I,J)}else{if(H>90&&H<270){this.translate(I-C.x-C.width-A-L,J-C.y-C.height/2);this.rotate(H-180,C.x+C.width+A+L,C.y+C.height/2)}else{this.translate(I-C.x+A+L,J-C.y-C.height/2);this.rotate(H,C.x-A-L,C.y+C.height/2)}}return B.insertBefore(this.node?this:this[0])};Raphael.el.drop=function(H,I,J){var C=this.getBBox(),F=this.paper||this[0].paper,A,D,B,E,G;if(!F){return}switch(this.type){case"text":case"circle":case"ellipse":A=true;break;default:A=false}H=H||0;I=typeof I=="number"?I:(A?C.x+C.width/2:C.x);J=typeof J=="number"?J:(A?C.y+C.height/2:C.y);D=Math.max(C.width,C.height)+Math.min(C.width,C.height);B=F.path(["M",I,J,"l",D,0,"A",D*0.4,D*0.4,0,1,0,I+D*0.7,J-D*0.7,"z"]).attr({fill:"#000",stroke:"none"}).rotate(22.5-H,I,J);H=(H+90)*Math.PI/180;E=(I+D*Math.sin(H))-(A?0:C.width/2);G=(J+D*Math.cos(H))-(A?0:C.height/2);this.attrs?this.attr(this.attrs.x?"x":"cx",E).attr(this.attrs.y?"y":"cy",G):this.translate(E-C.x,G-C.y);return B.insertBefore(this.node?this:this[0])};Raphael.el.flag=function(F,G,H){var I=3,E=this.paper||this[0].paper;if(!E){return}var B=E.path().attr({fill:"#000",stroke:"#000"}),C=this.getBBox(),D=C.height/2,A;switch(this.type){case"text":case"circle":case"ellipse":A=true;break;default:A=false}F=F||0;G=typeof G=="number"?G:(A?C.x+C.width/2:C.x);H=typeof H=="number"?H:(A?C.y+C.height/2:C.y);B.attr({path:["M",G,H,"l",D+I,-D-I,C.width+2*I,0,0,C.height+2*I,-C.width-2*I,0,"z"].join(",")});F=360-F;B.rotate(F,G,H);if(this.attrs){this.attr(this.attrs.x?"x":"cx",G+D+I+(!A?this.type=="text"?C.width:0:C.width/2)).attr("y",A?H:H-C.height/2);this.rotate(F,G,H);F>90&&F<270&&this.attr(this.attrs.x?"x":"cx",G-D-I-(!A?C.width:C.width/2)).rotate(180,G,H)}else{if(F>90&&F<270){this.translate(G-C.x-C.width-D-I,H-C.y-C.height/2);this.rotate(F-180,C.x+C.width+D+I,C.y+C.height/2)}else{this.translate(G-C.x+D+I,H-C.y-C.height/2);this.rotate(F,C.x-D-I,C.y+C.height/2)}}return B.insertBefore(this.node?this:this[0])};Raphael.el.label=function(){var C=this.getBBox(),B=this.paper||this[0].paper,A=Math.min(20,C.width+10,C.height+10)/2;if(!B){return}return B.rect(C.x-A/2,C.y-A/2,C.width+A,C.height+A,A).attr({stroke:"none",fill:"#000"}).insertBefore(this.node?this:this[0])};Raphael.el.blob=function(K,S,T){var C=this.getBBox(),G=Math.PI/180,J=this.paper||this[0].paper,A,M,E;if(!J){return}switch(this.type){case"text":case"circle":case"ellipse":M=true;break;default:M=false}A=J.path().attr({fill:"#000",stroke:"none"});K=(+K+1?K:45)+90;E=Math.min(C.height,C.width);S=typeof S=="number"?S:(M?C.x+C.width/2:C.x);T=typeof T=="number"?T:(M?C.y+C.height/2:C.y);var B=Math.max(C.width+E,E*25/12),F=Math.max(C.height+E,E*25/12),U=S+E*Math.sin((K-22.5)*G),V=T+E*Math.cos((K-22.5)*G),P=S+E*Math.sin((K+22.5)*G),Q=T+E*Math.cos((K+22.5)*G),I=(P-U)/2,O=(Q-V)/2,H=B/2,R=F/2,L=-Math.sqrt(Math.abs(H*H*R*R-H*H*O*O-R*R*I*I)/(H*H*O*O+R*R*I*I)),D=L*H*O/R+(P+U)/2,N=L*-R*I/H+(Q+V)/2;A.attr({x:D,y:N,path:["M",S,T,"L",P,Q,"A",H,R,0,1,1,U,V,"z"].join(",")});this.translate(D-C.x-C.width/2,N-C.y-C.height/2);return A.insertBefore(this.node?this:this[0])};Raphael.fn.label=function(B,C,A){var D=this.set();A=this.text(B,C,A).attr(Raphael.g.txtattr);return D.push(A.label(),A)};Raphael.fn.popup=function(D,E,C,A,B){var F=this.set();C=this.text(D,E,C).attr(Raphael.g.txtattr);return F.push(C.popup(A,B),C)};Raphael.fn.tag=function(C,D,B,F,A){var E=this.set();B=this.text(C,D,B).attr(Raphael.g.txtattr);return E.push(B.tag(F,A),B)};Raphael.fn.flag=function(B,C,A,E){var D=this.set();A=this.text(B,C,A).attr(Raphael.g.txtattr);return D.push(A.flag(E),A)};Raphael.fn.drop=function(B,C,A,E){var D=this.set();A=this.text(B,C,A).attr(Raphael.g.txtattr);return D.push(A.drop(E),A)};Raphael.fn.blob=function(B,C,A,E){var D=this.set();A=this.text(B,C,A).attr(Raphael.g.txtattr);return D.push(A.blob(E),A)};Raphael.fn.axis=function(G,H,C,F,I,E,D,J,B,A){return Raphael.g.axis(G,H,C,F,I,E,D,J,B,A,this)};Raphael.el.lighter=function(A){A=A||2;var B=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[B[0],B[1]];B[0]=Raphael.rgb2hsb(Raphael.getRGB(B[0]).hex);B[1]=Raphael.rgb2hsb(Raphael.getRGB(B[1]).hex);B[0].b=Math.min(B[0].b*A,1);B[0].s=B[0].s/A;B[1].b=Math.min(B[1].b*A,1);B[1].s=B[1].s/A;this.attr({fill:"hsb("+[B[0].h,B[0].s,B[0].b]+")",stroke:"hsb("+[B[1].h,B[1].s,B[1].b]+")"});return this};Raphael.el.darker=function(A){A=A||2;var B=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[B[0],B[1]];B[0]=Raphael.rgb2hsb(Raphael.getRGB(B[0]).hex);B[1]=Raphael.rgb2hsb(Raphael.getRGB(B[1]).hex);B[0].s=Math.min(B[0].s*A,1);B[0].b=B[0].b/A;B[1].s=Math.min(B[1].s*A,1);B[1].b=B[1].b/A;this.attr({fill:"hsb("+[B[0].h,B[0].s,B[0].b]+")",stroke:"hsb("+[B[1].h,B[1].s,B[1].b]+")"});return this};Raphael.el.resetBrightness=function(){if(this.fs){this.attr({fill:this.fs[0],stroke:this.fs[1]});delete this.fs}return this};(function(){var B=["lighter","darker","resetBrightness"],A=["popup","tag","flag","label","drop","blob"];for(var C in A){(function(D){Raphael.st[D]=function(){return Raphael.el[D].apply(this,arguments)}})(A[C])}for(var C in B){(function(D){Raphael.st[D]=function(){for(var E=0;E<this.length;E++){this[E][D].apply(this[E],arguments)}return this}})(B[C])}})();Raphael.g={shim:{stroke:"none",fill:"#000","fill-opacity":0},txtattr:{font:"12px Arial, sans-serif",fill:"#fff"},colors:(function(){var C=[0.6,0.2,0.05,0.1333,0.75,0],B=[];for(var A=0;A<10;A++){if(A<C.length){B.push("hsb("+C[A]+",.75, .75)")}else{B.push("hsb("+C[A-C.length]+", 1, .5)")}}return B})(),snapEnds:function(B,H,E){var I=B,C=H;if(I==C){return{from:I,to:C,power:0}}function F(K){return Math.abs(K-0.5)<0.25?~~(K)+0.5:Math.round(K)}var J=(C-I)/E,A=~~(J),G=A,D=0;if(A){while(G){D--;G=~~(J*Math.pow(10,D))/Math.pow(10,D)}D++}else{while(!A){D=D||1;A=~~(J*Math.pow(10,D))/Math.pow(10,D);D++}D&&D--}C=F(H*Math.pow(10,D))/Math.pow(10,D);if(C<H){C=F((H+0.5)*Math.pow(10,D))/Math.pow(10,D)}I=F((B-(D>0?0:0.5))*Math.pow(10,D))/Math.pow(10,D);return{from:I,to:C,power:D}},axis:function(g,h,W,T,B,Z,M,A,S,H,L){H=H==null?2:H;S=S||"t";Z=Z||10;L=arguments[arguments.length-1];var P=S=="|"||S==" "?["M",g+0.5,h,"l",0,0.001]:M==1||M==3?["M",g+0.5,h,"l",0,-W]:["M",g,h+0.5,"l",W,0],J=this.snapEnds(T,B,Z),O=J.from,D=J.to,I=J.power,F=0,b={font:"11px 'Fontin Sans', Fontin-Sans, sans-serif"},Q=L.set(),C;C=(D-O)/Z;var e=O,K=I>0?I:0;c=W/Z;if(+M==1||+M==3){var N=h,E=(M-1?1:-1)*(H+3+!!(M-1));while(N>=h-W){S!="-"&&S!=" "&&(P=P.concat(["M",g-(S=="+"||S=="|"?H:!(M-1)*H*2),N+0.5,"l",H*2+1,0]));Q.push(L.text(g+E,N,(A&&A[F++])||(Math.round(e)==e?e:+e.toFixed(K))).attr(b).attr({"text-anchor":M-1?"start":"end"}));e+=C;N-=c}if(Math.round(N+c-(h-W))){S!="-"&&S!=" "&&(P=P.concat(["M",g-(S=="+"||S=="|"?H:!(M-1)*H*2),h-W+0.5,"l",H*2+1,0]));Q.push(L.text(g+E,h-W,(A&&A[F])||(Math.round(e)==e?e:+e.toFixed(K))).attr(b).attr({"text-anchor":M-1?"start":"end"}))}}else{e=O;K=(I>0)*I;E=(M?-1:1)*(H+9+!M);var G=g,c=W/Z,R=0,a=0;while(G<=g+W){S!="-"&&S!=" "&&(P=P.concat(["M",G+0.5,h-(S=="+"?H:!!M*H*2),"l",0,H*2+1]));Q.push(R=L.text(G,h+E,(A&&A[F++])||(Math.round(e)==e?e:+e.toFixed(K))).attr(b));var U=R.getBBox();if(a>=U.x-5){Q.pop(Q.length-1).remove()}else{a=U.x+U.width}e+=C;G+=c}if(Math.round(G-c-g-W)){S!="-"&&S!=" "&&(P=P.concat(["M",g+W+0.5,h-(S=="+"?H:!!M*H*2),"l",0,H*2+1]));Q.push(L.text(g+W,h+E,(A&&A[F])||(Math.round(e)==e?e:+e.toFixed(K))).attr(b))}}var V=L.path(P);V.text=Q;V.all=L.set([V,Q]);V.remove=function(){this.text.remove();this.constructor.prototype.remove.call(this)};return V},labelise:function(A,C,B){if(A){return(A+"").replace(/(##+(?:\.#+)?)|(%%+(?:\.%+)?)/g,function(D,F,E){if(F){return(+C).toFixed(F.replace(/^#+\.?/g,"").length)}if(E){return(C*100/B).toFixed(E.replace(/^%+\.?/g,"").length)+"%"}})}else{return(+C).toFixed(0)}}};