/*
 * g.Raphael 0.5 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
(function(){var G=Math.min,E=Math.max;function A(P,Q,N,J,K,M,H,O){var R,I={round:"round",sharp:"sharp",soft:"soft",square:"square"};if((K&&!J)||(!K&&!N)){return H?"":O.path()}M=I[M]||"square";J=Math.round(J);N=Math.round(N);P=Math.round(P);Q=Math.round(Q);switch(M){case"round":if(!K){var F=~~(J/2);if(N<F){F=N;R=["M",P+0.5,Q+0.5-~~(J/2),"l",0,0,"a",F,~~(J/2),0,0,1,0,J,"l",0,0,"z"]}else{R=["M",P+0.5,Q+0.5-F,"l",N-F,0,"a",F,F,0,1,1,0,J,"l",F-N,0,"z"]}}else{F=~~(N/2);if(J<F){F=J;R=["M",P-~~(N/2),Q,"l",0,0,"a",~~(N/2),F,0,0,1,N,0,"l",0,0,"z"]}else{R=["M",P-F,Q,"l",0,F-J,"a",F,F,0,1,1,N,0,"l",0,J-F,"z"]}}break;case"sharp":if(!K){var L=~~(J/2);R=["M",P,Q+L,"l",0,-J,E(N-L,0),0,G(L,N),L,-G(L,N),L+(L*2<J),"z"]}else{L=~~(N/2);R=["M",P+L,Q,"l",-N,0,0,-E(J-L,0),L,-G(L,J),L,G(L,J),L,"z"]}break;case"square":if(!K){R=["M",P,Q+~~(J/2),"l",0,-J,N,0,0,J,"z"]}else{R=["M",P+~~(N/2),Q,"l",1-N,0,0,-J,N-1,0,"z"]}break;case"soft":if(!K){F=G(N,Math.round(J/5));R=["M",P+0.5,Q+0.5-~~(J/2),"l",N-F,0,"a",F,F,0,0,1,F,F,"l",0,J-F*2,"a",F,F,0,0,1,-F,F,"l",F-N,0,"z"]}else{F=G(Math.round(N/5),J);R=["M",P-~~(N/2),Q,"l",0,F-J,"a",F,F,0,0,1,F,-F,"l",N-2*F,0,"a",F,F,0,0,1,F,F,"l",0,J-F,"z"]}}if(H){return R.join(",")}else{return O.path(R)}}function D(R,q,r,K,M,b,Z){Z=Z||{};var Ab=this,F=Z.type||"square",O=parseFloat(Z.gutter||"20%"),L=R.set(),Aa=R.set(),u=R.set(),g=R.set(),v=Math.max.apply(Math,b),I=[],e=0,J=Z.colors||Ab.colors,V=b.length;if(Raphael.is(b[0],"array")){v=[];e=V;V=0;for(var Q=b.length;Q--;){Aa.push(R.set());v.push(Math.max.apply(Math,b[Q]));V=Math.max(V,b[Q].length)}if(Z.stacked){for(var Q=V;Q--;){var P=0;for(var w=b.length;w--;){P+=+b[w][Q]||0}I.push(P)}}for(var Q=b.length;Q--;){if(b[Q].length<V){for(var w=V;w--;){b[Q].push(0)}}}v=Math.max.apply(Math,Z.stacked?I:v)}v=(Z.to)||v;var W=K/(V*(100+O)+O)*100,Ad=W*O/100,Ac=Z.vgutter==null?20:Z.vgutter,p=[],T=q+Ad,U=(M-2*Ac)/v;if(!Z.stretch){Ad=Math.round(Ad);W=Math.floor(W)}!Z.stacked&&(W/=e||1);for(var Q=0;Q<V;Q++){p=[];for(var w=0;w<(e||1);w++){var z=Math.round((e?b[w][Q]:b[Q])*U),S=r+M-Ac-z,d=A(Math.round(T+W/2),S+z,W,z,true,F,null,R).attr({stroke:"none",fill:J[e?w:Q]});if(e){Aa[w].push(d)}else{Aa.push(d)}d.y=S;d.x=Math.round(T+W/2);d.w=W;d.h=z;d.value=e?b[w][Q]:b[Q];if(!Z.stacked){T+=W}else{p.push(d)}}if(Z.stacked){var c;g.push(c=R.rect(p[0].x-p[0].w/2,r,W,M).attr(Ab.shim));c.bars=R.set();var Ae=0;for(var t=p.length;t--;){p[t].toFront()}for(var t=0,Af=p.length;t<Af;t++){var d=p[t],H,z=(Ae+d.value)*U,k=A(d.x,r+M-Ac-!!Ae*0.5,W,z,true,F,1,R);c.bars.push(d);Ae&&d.attr({path:k});d.h=z;d.y=r+M-Ac-!!Ae*0.5-z;u.push(H=R.rect(d.x-d.w/2,d.y,W,d.value*U).attr(Ab.shim));H.bar=d;H.value=d.value;Ae+=d.value}T+=W}T+=Ad}g.toFront();T=q+Ad;if(!Z.stacked){for(var Q=0;Q<V;Q++){for(var w=0;w<(e||1);w++){var H;u.push(H=R.rect(Math.round(T),r+Ac,W,M-Ac).attr(Ab.shim));H.bar=e?Aa[w][Q]:Aa[Q];H.value=H.bar.value;T+=W}T+=Ad}}var a=Ab.snapEnds(0,V,1),f=a.from,o=a.to,l=Ab.snapEnds(0,v,1),N=l.from,m=l.to;var n=R.set();if(Z.axis){var Ag=(Z.axis+"").split(/[,\s]+/);+Ag[0]&&n.push(R.path(["M",q,r+O+0.5,"h",K]));+Ag[1]&&n.push(Ab.axis(q+K,r+M-O,M-2*O,N,m,Z.axisystep||Math.floor((M-O)/20),3,R));+Ag[2]&&n.push(R.path(["M",q,r+M-O+0.5,"h",K]));+Ag[3]&&n.push(Ab.axis(q,r+M-O,M-2*O,N,m,Z.axisystep||Math.floor((M-O)/20),1,R))}L.label=function(Ak,Aj){Ak=Ak||[];this.labels=R.set();var h,Ah=-Infinity;if(Z.stacked){for(var y=0;y<V;y++){var X=0;for(var x=0;x<(e||1);x++){X+=e?b[x][y]:b[y];var s=e?Aa[x][y]:Aa[y];if(x==e-1){var Ai=Ab.labelise(Ak[y],X,v);h=R.text(s.x,r+M-Ac/2,Ai).insertBefore(u[y*(e||1)+x]);var Y=h.getBBox();if(Y.x-7<Ah){h.remove()}else{this.labels.push(h);Ah=Y.x+Y.width}}}}}else{for(var y=0;y<V;y++){for(var x=0;x<(e||1);x++){var Ai=Ab.labelise(e?Ak[x]&&Ak[x][y]:Ak[y],e?b[x][y]:b[y],v);var s=e?Aa[x][y]:Aa[y];h=R.text(s.x,Aj?r+M-Ac/2:s.y-10,Ai).insertBefore(u[y*(e||1)+x]);var Y=h.getBBox();if(Y.x-7<Ah){h.remove()}else{this.labels.push(h);Ah=Y.x+Y.width}}}}return this};L.hover=function(X,Y){g.hide();u.show();u.mouseover(X).mouseout(Y);return this};L.hoverColumn=function(X,Y){u.hide();g.show();Y=Y||function(){};g.mouseover(X).mouseout(Y);return this};L.click=function(X){g.hide();u.show();u.click(X);return this};L.each=function(Y){if(!Raphael.is(Y,"function")){return this}for(var X=u.length;X--;){Y.call(u[X])}return this};L.eachColumn=function(Y){if(!Raphael.is(Y,"function")){return this}for(var X=g.length;X--;){Y.call(g[X])}return this};L.clickColumn=function(X){u.hide();g.show();g.click(X);return this};L.push(Aa,u,g);L.bars=Aa;L.covers=u;L.axis=n;return L}function C(S,q,r,J,L,b,Z){Z=Z||{};var Aa=this,F=Z.type||"square",N=parseFloat(Z.gutter||"20%"),K=S.set(),z=S.set(),u=S.set(),g=S.set(),v=Math.max.apply(Math,b),I=[],e=0,W=Z.colors||Aa.colors,p=b.length;if(Raphael.is(b[0],"array")){v=[];e=p;p=0;for(var R=b.length;R--;){z.push(S.set());v.push(Math.max.apply(Math,b[R]));p=Math.max(p,b[R].length)}if(Z.stacked){for(var R=p;R--;){var P=0;for(var w=b.length;w--;){P+=+b[w][R]||0}I.push(P)}}for(var R=b.length;R--;){if(b[R].length<p){for(var w=p;w--;){b[R].push(0)}}}v=Math.max.apply(Math,Z.stacked?I:v)}v=(Z.to)||v;var O=Math.floor(L/(p*(100+N)+N)*100),V=Math.floor(O*N/100),o=[],U=r+V,T=(J-1)/v;!Z.stacked&&(O/=e||1);for(var R=0;R<p;R++){o=[];for(var w=0;w<(e||1);w++){var Q=e?b[w][R]:b[R],d=A(q,U+O/2,Math.round(Q*T),O-1,false,F,null,S).attr({stroke:"none",fill:W[e?w:R]});if(e){z[w].push(d)}else{z.push(d)}d.x=q+Math.round(Q*T);d.y=U+O/2;d.w=Math.round(Q*T);d.h=O;d.value=+Q;if(!Z.stacked){U+=O}else{o.push(d)}}if(Z.stacked){var c=S.rect(q,o[0].y-o[0].h/2,J,O).attr(Aa.shim);g.push(c);c.bars=S.set();var Ab=0;for(var t=o.length;t--;){o[t].toFront()}for(var t=0,Ac=o.length;t<Ac;t++){var d=o[t],H,Q=Math.round((Ab+d.value)*T),h=A(q,d.y,Q,O-1,false,F,1,S);c.bars.push(d);Ab&&d.attr({path:h});d.w=Q;d.x=q+Q;u.push(H=S.rect(q+Ab*T,d.y-d.h/2,d.value*T,O).attr(Aa.shim));H.bar=d;Ab+=d.value}U+=O}U+=V}g.toFront();U=r+V;if(!Z.stacked){for(var R=0;R<p;R++){for(var w=0;w<(e||1);w++){var H=S.rect(q,U,J,O).attr(Aa.shim);u.push(H);H.bar=e?z[w][R]:z[R];H.value=H.bar.value;U+=O}U+=V}}var a=Aa.snapEnds(0,v,1),f=a.from,n=a.to,k=Aa.snapEnds(0,p,1),M=k.from,l=k.to;var m=S.set();if(Z.axis){var Ad=(Z.axis+"").split(/[,\s]+/);+Ad[0]&&m.push(Aa.axis(q,r,J,f,n,Z.axisxstep||Math.floor((J)/20),2,S));+Ad[1]&&m.push(S.path(["M",q+J+0.5,r,"v",L]));+Ad[2]&&m.push(Aa.axis(q,r+L,J,f,n,Z.axisxstep||Math.floor((J)/20),0,S));+Ad[3]&&m.push(S.path(["M",q+0.5,r,"v",L]))}K.label=function(Ai,Ah){Ai=Ai||[];this.labels=S.set();for(var y=0;y<p;y++){for(var s=0;s<e;s++){var Af=e?z[s][y]:z[y];var Ag=Aa.labelise(e?Ai[s]&&Ai[s][y]:Ai[y],e?b[s][y]:b[y],v),x=Ah?Af.x-O/2+3:q+5,Ae=Ah?"end":"start",Y;this.labels.push(Y=S.text(x,Af.y,Ag).attr({"text-anchor":Ae}).insertBefore(u[y*(e||1)+s]));if(Y.getBBox().x<q+5){Y.attr({x:q+5,"text-anchor":"start"})}else{Af.label=Y}}}return this};K.hover=function(X,Y){g.hide();u.show();Y=Y||function(){};u.mouseover(X).mouseout(Y);return this};K.hoverColumn=function(X,Y){u.hide();g.show();Y=Y||function(){};g.mouseover(X).mouseout(Y);return this};K.each=function(Y){if(!Raphael.is(Y,"function")){return this}for(var X=u.length;X--;){Y.call(u[X])}return this};K.eachColumn=function(Y){if(!Raphael.is(Y,"function")){return this}for(var X=g.length;X--;){Y.call(g[X])}return this};K.click=function(X){g.hide();u.show();u.click(X);return this};K.clickColumn=function(X){u.hide();g.show();g.click(X);return this};K.push(z,u,g);K.bars=z;K.covers=u;return K}var B=function(){};B.prototype=Raphael.g;C.prototype=D.prototype=new B;Raphael.fn.hbarchart=function(J,K,L,F,I,H){return new C(this,J,K,L,F,I,H)};Raphael.fn.barchart=function(J,K,L,F,I,H){return new D(this,J,K,L,F,I,H)}})();