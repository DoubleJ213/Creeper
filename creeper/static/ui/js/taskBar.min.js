(function(A){A.fn.extend({jTask:function(B){return this.each(function(){var C=A(this);var D=C.attr("id");C.click(function(E){var F=A("body").data(D);if(C.hasClass("selected")){A("a.minimize",F).trigger("click")}else{if(F.is(":hidden")){A.taskBar.restoreDialog(F)}else{A(F).trigger("click")}}A.taskBar.scrollCurrent(A(this));return false});A("div.close",C).click(function(E){A.pdialog.close(D);return false}).hoverClass("closeHover");C.hoverClass("hover")})}});A.taskBar={_taskBar:null,_taskBox:null,_prevBut:null,_nextBut:null,_op:{id:"taskbar",taskBox:"div.taskbarContent",prevBut:".taskbarLeft",prevDis:"taskbarLeftDisabled",nextBut:".taskbarRight",nextDis:"taskbarRightDisabled",selected:"selected",boxMargin:"taskbarMargin"},init:function(C){var B=this;A.extend(this._op,C);this._taskBar=A("#"+this._op.id);if(this._taskBar.size()==0){this._taskBar=A(DWZ.frag["taskbar"]).appendTo(A("#layout"));this._taskBar.find(".taskbarLeft").hoverClass("taskbarLeftHover");this._taskBar.find(".taskbarRight").hoverClass("taskbarRightHover")}this._taskBox=this._taskBar.find(this._op.taskBox);this._taskList=this._taskBox.find(">ul");this._prevBut=this._taskBar.find(this._op.prevBut);this._nextBut=this._taskBar.find(this._op.nextBut);this._prevBut.click(function(D){B.scrollLeft()});this._nextBut.click(function(D){B.scrollRight()});this._contextmenu(this._taskBox)},_contextmenu:function(B){A(B).contextMenu("dialogCM",{bindings:{closeCurrent:function(E,D){var C=E.isTag("li")?E:A.taskBar._getCurrent();A("div.close",C).trigger("click")},closeOther:function(F,E){var D=F.isTag("li")?("#"+F.attr("id")):".selected";var C=A.taskBar._taskList.find(">li:not(:"+D+")");C.each(function(G){A("div.close",C[G]).trigger("click")})},closeAll:function(E,D){var C=A.taskBar._getTasks();C.each(function(F){A("div.close",C[F]).trigger("click")})}},ctrSub:function(E,D){var F=D.find("[rel='closeCurrent']");var C=D.find("[rel='closeOther']");if(!A.taskBar._getCurrent()[0]){F.addClass("disabled");C.addClass("disabled")}else{if(A.taskBar._getTasks().size()==1){C.addClass("disabled")}}}})},_scrollCurrent:function(){var D=this._tasksW(this._getTasks());if(D>this._getTaskBarW()){var C=this;var E=A(">li:last-child",this._taskList);var B=this._getTaskBarW()-E.position().left-E.outerWidth(true);this._taskList.animate({left:B+"px"},200,function(){C._ctrlScrollBut()})}else{this._ctrlScrollBut()}},_getTaskBarW:function(){return this._taskBox.width()-(this._prevBut.is(":hidden")?this._prevBut.width()+2:0)-(this._nextBut.is(":hidden")?this._nextBut.width()+2:0)},_scrollTask:function(D){var C=this;if(D.position().left+this._getLeft()+D.outerWidth()>this._getBarWidth()){var B=this._getTaskBarW()-D.position().left-D.outerWidth(true)-2;this._taskList.animate({left:B+"px"},200,function(){C._ctrlScrollBut()})}else{if(D.position().left+this._getLeft()<0){var B=this._getLeft()-(D.position().left+this._getLeft());this._taskList.animate({left:B+"px"},200,function(){C._ctrlScrollBut()})}}},_ctrlScrollBut:function(){var B=this._tasksW(this._getTasks());if(this._getTaskBarW()>B){this._taskBox.removeClass(this._op.boxMargin);this._nextBut.hide();this._prevBut.hide();if(this._getTasks().eq(0)[0]){this._scrollTask(this._getTasks().eq(0))}}else{this._taskBox.addClass(this._op.boxMargin);this._nextBut.show().removeClass(this._op.nextDis);this._prevBut.show().removeClass(this._op.prevDis);if(this._getLeft()>=0){this._prevBut.addClass(this._op.prevDis)}if(this._getLeft()<=this._getTaskBarW()-B){this._nextBut.addClass(this._op.nextDis)}}},_getLeft:function(){return this._taskList.position().left},_visibleStart:function(){var C=this._getLeft();var D=this._getTasks();for(var B=0;B<D.size();B++){if(D.eq(B).position().left+D.eq(B).outerWidth(true)+C>=0){return D.eq(B)}}return D.eq(0)},_visibleEnd:function(){var C=this._getLeft();var D=this._getTasks();for(var B=0;B<D.size();B++){if(D.eq(B).position().left+D.eq(B).outerWidth(true)+C>this._getBarWidth()){return D.eq(B)}}return D.eq(D.size()-1)},_getTasks:function(){return this._taskList.find(">li")},_tasksW:function(C){var B=0;C.each(function(){B+=A(this).outerWidth(true)});return B},_getBarWidth:function(){return this._taskBar.innerWidth(true)},addDialog:function(E,C){this.show();var D=A("#"+E,this._taskList);if(!D[0]){var B='<li id="#taskid#"><div class="taskbutton"><span>#title#</span></div><div class="close">Close</div></li>';this._taskList.append(B.replace("#taskid#",E).replace("#title#",C));D=A("#"+E,this._taskList);D.jTask()}else{A(">div>span",D).text(C)}this._contextmenu(D);this.switchTask(E);this._scrollTask(D)},closeDialog:function(B){var C=(typeof B=="string")?A("#"+B,this._taskList):B;C.remove();if(this._getTasks().size()==0){this.hide()}this._scrollCurrent()},restoreDialog:function(B){var E=(typeof B=="string")?A("body").data(B):B;var C=(typeof B=="string")?B:E.data("id");var D=A.taskBar.getTask(C);A(".resizable").css({top:A(window).height()-60,left:A(D).position().left,height:A(D).outerHeight(),width:A(D).outerWidth()}).show().animate({top:A(E).css("top"),left:A(E).css("left"),width:A(E).css("width"),height:A(E).css("height")},250,function(){A(this).hide();A(E).show();A.pdialog.attachShadow(E)});A.taskBar.switchTask(C)},inactive:function(B){A("#"+B,this._taskList).removeClass("selected")},scrollLeft:function(){var B=this._visibleStart();this._scrollTask(B)},scrollRight:function(){var B=this._visibleEnd();this._scrollTask(B)},scrollCurrent:function(B){this._scrollTask(B)},switchTask:function(B){this._getCurrent().removeClass("selected");this.getTask(B).addClass("selected")},_getCurrent:function(){return this._taskList.find(">.selected")},getTask:function(B){return A("#"+B,this._taskList)},show:function(){if(this._taskBar.is(":hidden")){this._taskBar.css("top",A(window).height()-34+this._taskBar.outerHeight()).show();this._taskBar.animate({top:A(window).height()-this._taskBar.outerHeight()},500)}},hide:function(){this._taskBar.animate({top:A(window).height()-29+this._taskBar.outerHeight(true)},500,function(){A.taskBar._taskBar.hide()})}}})(jQuery);