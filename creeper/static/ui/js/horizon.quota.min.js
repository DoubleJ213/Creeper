horizon.Quota={is_flavor_quota:false,user_value_progress_bars:[],auto_value_progress_bars:[],flavor_progress_bars:[],user_value_form_inputs:[],selected_flavor:null,flavors:[],init:function(){this.user_value_progress_bars=$("div[data-progress-indicator-for]");this.auto_value_progress_bars=$("div[data-progress-indicator-step-by]");this.user_value_form_inputs=$($.map(this.user_value_progress_bars,function(A){return("#"+$(A).attr("data-progress-indicator-for"))}));this._initialAnimations();this._attachInputHandlers()},initWithFlavors:function(A){this.is_flavor_quota=true;this.flavor_progress_bars=$("div[data-progress-indicator-flavor]");this.flavors=A;this.init();this.showFlavorDetails();this.updateFlavorUsage()},getSelectedFlavor:function(){if(this.is_flavor_quota){this.selected_flavor=_.find(this.flavors,function(A){return A.id==$("#id_flavor").children(":selected").val()})}else{this.selected_flavor=null}return this.selected_flavor},showFlavorDetails:function(){this.getSelectedFlavor();if(this.selected_flavor){var D=horizon.utils.truncate(this.selected_flavor.name,14,true);var B=horizon.utils.humanizeNumbers(this.selected_flavor.vcpus);var E=horizon.utils.humanizeNumbers(this.selected_flavor.disk);var C=horizon.utils.humanizeNumbers(this.selected_flavor["OS-FLV-EXT-DATA:ephemeral"]);var G=this.selected_flavor.disk+this.selected_flavor["OS-FLV-EXT-DATA:ephemeral"];var A=horizon.utils.humanizeNumbers(G);var F=horizon.utils.humanizeNumbers(this.selected_flavor.ram);$("#flavor_name").html(D);$("#flavor_vcpus").text(B);$("#flavor_disk").text(E);$("#flavor_ephemeral").text(C);$("#flavor_disk_total").text(A);$("#flavor_ram").text(F)}},update:function(D,A,B){var C=B;if(B+A>100){C=100-A;if(!D.hasClass("progress_bar_over")){D.addClass("progress_bar_over")}}else{D.removeClass("progress_bar_over")}D.animate({width:parseInt(C,10)+"%"},300)},updateFlavorUsage:function(){if(!this.is_flavor_quota){return}var C=this;var B=(parseInt($("#id_count").val(),10)||1);var A=0;this.getSelectedFlavor();$(this.flavor_progress_bars).each(function(E,F){var D=$(F).attr("id");var G=D.match(/^quota_(.+)/)[1];if(G===undefined){return}else{if(G==="instances"){A=B}else{if(C.selected_flavor){A=(C.selected_flavor[G]*B)}}}C.updateUsageFor(F,A)})},updateUsageFor:function(F,B){F=$(F);var D=F.find(".progress_bar_selected");var E=parseInt(F.attr("data-quota-limit"),10);var G=parseInt(F.attr("data-quota-used"),10);var C=((B/E)*100);var A=((G/E)*100);this.update(D,A,C)},_attachInputHandlers:function(){var A=this;if(this.is_flavor_quota){var B=function(C){A.showFlavorDetails();A.updateFlavorUsage()};$("#id_flavor").on("change",B);$("#id_count").on("keyup",B)}if(this.user_value_form_inputs){$(this.user_value_form_inputs).each(function(C,D){$(D).on("change",function(G){var H=$("div[data-progress-indicator-for="+$(G.target).attr("id")+"]");var I=$(G.target).val();var J=I=="max"?"100":I=="large"?"50":I=="medium"?"25":I=="small"?"10":"0";var E;J=J.match(/\d+/g);if(J===null){E=0}else{if(J.length>1){E=J.join("")}else{if(J.length==1){E=J[0]}}}var F=parseInt(E,10);A.updateUsageFor(H,F)})})}},_initialAnimations:function(){var A=this;$(this.auto_value_progress_bars).each(function(C,D){var E=$(D);var B=parseInt(E.attr("data-progress-indicator-step-by"),10);A.updateUsageFor(E,B)})}};