(function(C){var B={cursor:"move",sortBoxs:"div.sortDrag",replace:true,items:"> *",selector:"",zIndex:1000};var A={start:function(E,F,I,G){var D=this._createPlaceholder(F);var J=F.clone();var H=F.position();J.data("$sortBox",E).data("op",G).data("$item",F).data("$placeholder",D);J.addClass("sortDragHelper").css({position:"absolute",top:H.top,left:H.left,zIndex:G.zIndex,width:F.width()+"px",height:F.height()+"px"}).jDrag({selector:G.selector,drag:this.drag,stop:this.stop,event:I});F.before(D).before(J).hide();return false},drag:function(){var K=C(arguments[0]),F=K.data("$sortBox"),G=K.data("$placeholder");var I=F.find(K.data("op")["items"]).filter(":visible").filter(":not(.sortDragPlaceholder, .sortDragHelper)");var D=K.position(),L=I.eq(0).position();var E=A._getOverSortBox(K);if(E.length>0&&E[0]!=F[0]){G.appendTo(E);K.data("$sortBox",E)}else{for(var J=0;J<I.length;J++){var M=I.eq(J),H=M.position();if(D.top>H.top+10){M.after(G)}else{if(D.top<=H.top){M.before(G);break}}}}},stop:function(){var E=C(arguments[0]),F=E.data("$item"),D=E.data("$placeholder");var G=D.position();E.animate({top:G.top+"px",left:G.left+"px"},{complete:function(){if(E.data("op")["replace"]){$srcBox=F.parents(B.sortBoxs+":first");$destBox=D.parents(B.sortBoxs+":first");if($srcBox[0]!=$destBox[0]){$replaceItem=D.next();if($replaceItem.size()>0){$replaceItem.insertAfter(F)}}}F.insertAfter(D).show();D.remove();E.remove()},duration:300})},_createPlaceholder:function(D){return C("<"+D[0].nodeName+' class="sortDragPlaceholder"/>').css({width:D.outerWidth()+"px",height:D.outerHeight()+"px",marginTop:D.css("marginTop"),marginRight:D.css("marginRight"),marginBottom:D.css("marginBottom"),marginLeft:D.css("marginLeft")})},_getOverSortBox:function(D){var F=D.position();var G=F.top+(D.height()/2),E=F.left+(D.width()/2);return C(B.sortBoxs).filter(":visible").filter(function(){var I=C(this),H=I.position();return DWZ.isOver(G,E,H.top,H.left,I.height(),I.width())})}};C.fn.sortDrag=function(D){return this.each(function(){var F=C.extend({},B,D);var E=C(this);if(E.attr("selector")){F.selector=E.attr("selector")}E.find(F.items).each(function(G){var H=C(this),I=H;if(F.selector){I=H.find(F.selector).css({cursor:F.cursor})}I.mousedown(function(J){A.start(E,H,J,F);J.preventDefault()})})})}})(jQuery);