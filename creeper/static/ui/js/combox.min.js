(function(C){var A=[];var B=function(D){C.each(A,function(E){if(A[E]!=D){if(!C("#"+A[E])[0]){C("#op_"+A[E]).remove()}else{C("#op_"+A[E]).css({height:"",width:""}).hide()}C(document).unbind("click",B)}})};C.extend(C.fn,{comboxSelect:function(E){var D=C.extend({selector:">a"},E);return this.each(function(){var F=C(this);var G=C(D.selector,F);A.push(F.attr("id"));C(D.selector,F).click(function(){var I=C("#op_"+F.attr("id"));if(I.is(":hidden")){if(I.height()>300){I.css({height:"300px",overflow:"scroll"})}var H=F.offset().top+F[0].offsetHeight-50;if(H+I.height()>C(window).height()-20){H=C(window).height()-20-I.height()}I.css({top:H,left:F.offset().left}).show();B(F.attr("id"));C(document).click(B)}else{C(document).unbind("click",B);B()}return false});C("#op_"+F.attr("id")).find(">li").comboxOption(G,F)})},comboxOption:function(E,D){return this.each(function(){C(">a",this).click(function(){var G=C(this);G.parent().parent().find(".selected").removeClass("selected");G.addClass("selected");E.text(G.text());var F=C("select",D);if(F.val()!=G.attr("value")){C("select",D).val(G.attr("value")).trigger("change")}})})},combox:function(){var D=[];C.each(A,function(E){if(C("#"+A[E])[0]){D.push(A[E])}else{C("#op_"+A[E]).remove()}});A=D;return this.each(function(K){var O=C(this).removeClass("combox");var G=O.attr("name");var J=O.val();var N=C("option[value="+J+"]",O).text();var H=O.attr("ref");var F=O.attr("refUrl")||"";var M=O.attr("id")||Math.round(Math.random()*10000000);var E='<div class="combox"><div id="combox_'+M+'" class="select"'+(H?' ref="'+H+'"':"")+">";E+='<a href="javascript:" class="'+O.attr("class")+'" name="'+G+'" value="'+J+'">'+N+"</a></div></div>";var I='<ul class="comboxop" id="op_combox_'+M+'">';C("option",O).each(function(){var P=C(this);I+='<li><a class="'+(J==P[0].value?"selected":"")+'" href="#" value="'+P[0].value+'">'+P[0].text+"</a></li>"});I+="</ul>";C("body").append(I);O.after(E);C("div.select",O.next()).comboxSelect().append(O);if(H&&F){function L(Q){var R=C("#"+H);if(R.size()==0){return false}var P=O.attr("method")||"POST";C.ajax({type:P,dataType:"json",url:F.replace("{value}",encodeURIComponent(O.attr("value"))),cache:false,data:{},success:function(U){if(!U){return}var S="";C.each(U,function(V){if(U[V]&&U[V].length>1){S+='<option value="'+U[V][0]+'">'+U[V][1]+"</option>"}});var T=R.parents("div.combox:first");R.html(S).insertAfter(T);T.remove();R.trigger("change").combox()},error:DWZ.ajaxError})}O.unbind("change",L).bind("change",L)}})}})})(jQuery);