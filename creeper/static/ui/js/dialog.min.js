(function(A){A.pdialog={_op:{height:300,width:580,minH:40,minW:50,total:20,max:false,mask:false,resizable:true,drawable:true,maxable:true,minable:true,fresh:true},_current:null,_zIndex:42,getCurrent:function(){return this._current},reload:function(B,D){var C=A.extend({data:{},dialogId:"",callback:null},D);var F=(C.dialogId&&A("body").data(C.dialogId))||this._current;if(F){var E=F.find(".dialogContent");E.ajaxUrl({type:"POST",url:B,data:C.data,callback:function(G){E.find("[layoutH]").layoutH(E);A(".pageContent",F).width(A(F).width()-14);A(":button.close",F).click(function(){A.pdialog.close(F);return false});if(A.isFunction(C.callback)){C.callback(G)}}})}},open:function(C,B,F,E){var D=A.extend({},A.pdialog._op,E);var H=A("body").data(B);if(H){A.pdialog.close(H)}A("body").append(DWZ.frag["dialogFrag"]);H=A(">.dialog:last-child","body");H.data("id",B);H.data("url",C);if(E.close){H.data("close",E.close)}if(E.param){H.data("param",E.param)}(A.fn.bgiframe&&H.bgiframe());H.find(".dialogHeader").find("h1").html(F);A(H).css("zIndex",(A.pdialog._zIndex+=2));A("div.shadow").css("zIndex",A.pdialog._zIndex-3).show();A.pdialog._init(H,E);A(H).click(function(){A.pdialog.switchDialog(H)});if(D.resizable){H.jresize()}if(D.drawable){H.dialogDrag()}A("a.close",H).click(function(I){A.pdialog.close(H);return false});if(D.maxable){A("a.maximize",H).show().click(function(I){A.pdialog.switchDialog(H);A.pdialog.maxsize(H);H.jresize("destroy").dialogDrag("destroy");return false})}else{A("a.maximize",H).hide()}A("a.restore",H).click(function(I){A.pdialog.restore(H);H.jresize().dialogDrag();return false});A("div.dialogHeader a",H).mousedown(function(){return false});A("div.dialogHeader",H).dblclick(function(){if(A("a.restore",H).is(":hidden")){A("a.maximize",H).trigger("click")}else{A("a.restore",H).trigger("click")}});if(D.max){A.pdialog.maxsize(H);H.jresize("destroy").dialogDrag("destroy")}A("body").data(B,H);A.pdialog._current=H;A.pdialog.attachShadow(H);var G=A(".dialogContent",H);G.loadUrl(C,{},function(){G.find("[layoutH]").layoutH(G);A(".pageContent",H).width(A(H).width()-14);A("button.close").click(function(){A.pdialog.close(H);return false})});if(D.mask){A(H).css("zIndex",1000);A("a.minimize",H).hide();A(H).data("mask",true);A("#dialogBackground").show()}else{if(D.minable){}}},switchDialog:function(D){var C=A(D).css("zIndex");A.pdialog.attachShadow(D);if(A.pdialog._current){var B=A(A.pdialog._current).css("zIndex");A(A.pdialog._current).css("zIndex",C);A(D).css("zIndex",B);A("div.shadow").css("zIndex",B-1);A.pdialog._current=D}A.taskBar.switchTask(D.data("id"))},attachShadow:function(C){var B=A("div.shadow");if(B.is(":hidden")){B.show()}B.css({top:parseInt(A(C)[0].style.top)-2,left:parseInt(A(C)[0].style.left)-4,height:parseInt(A(C).height())+8,width:parseInt(A(C).width())+8,zIndex:parseInt(A(C).css("zIndex"))-1});A(".shadow_c",B).children().andSelf().each(function(){A(this).css("height",A(C).outerHeight()-4)})},_init:function(G,D){var C=A.extend({},this._op,D);var B=C.height>C.minH?C.height:C.minH;var E=C.width>C.minW?C.width:C.minW;if(isNaN(G.height())||G.height()<B){A(G).height(B+"px");A(".dialogContent",G).height(B-A(".dialogHeader",G).outerHeight()-A(".dialogFooter",G).outerHeight()-6)}if(isNaN(G.css("width"))||G.width()<E){A(G).width(E+"px")}var F=(A(window).height()-G.height())/2;G.css({left:(A(window).width()-G.width())/2,top:F>0?F:0})},initResize:function(B,D,C){A("body").css("cursor",C+"-resize");B.css({top:A(D).css("top"),left:A(D).css("left"),height:A(D).css("height"),width:A(D).css("width")});B.show()},repaint:function(D,C){var B=A("div.shadow");if(D!="w"&&D!="e"){B.css("height",B.outerHeight()+C.tmove);A(".shadow_c",B).children().andSelf().each(function(){A(this).css("height",A(this).outerHeight()+C.tmove)})}if(D=="n"||D=="nw"||D=="ne"){B.css("top",C.otop-2)}if(C.owidth&&(D!="n"||D!="s")){B.css("width",C.owidth+8)}if(D.indexOf("w")>=0){B.css("left",C.oleft-4)}},resizeTool:function(C,D,B){A("div[class^='resizable']",B).filter(function(){return A(this).attr("tar")=="w"||A(this).attr("tar")=="e"}).each(function(){A(this).css("height",A(this).outerHeight()+D)})},resizeDialog:function(H,C,G){var E=parseInt(H.style.left);var D=parseInt(H.style.top);var B=parseInt(H.style.height);var F=parseInt(H.style.width);if(G=="n"||G=="nw"){tmove=parseInt(A(C).css("top"))-D}else{tmove=B-parseInt(A(C).css("height"))}A(C).css({left:E,width:F,top:D,height:B});A(".dialogContent",C).css("width",(F-12)+"px");A(".pageContent",C).css("width",(F-14)+"px");if(G!="w"&&G!="e"){var I=A(".dialogContent",C);I.css({height:B-A(".dialogHeader",C).outerHeight()-A(".dialogFooter",C).outerHeight()-6});I.find("[layoutH]").layoutH(I);A.pdialog.resizeTool(G,tmove,C)}A.pdialog.repaint(G,{oleft:E,otop:D,tmove:tmove,owidth:F});A(window).trigger(DWZ.eventType.resizeGrid)},close:function(E){if(typeof E=="string"){E=A("body").data(E)}var B=E.data("close");var D=true;if(B&&A.isFunction(B)){var C=E.data("param");if(C&&C!=""){C=DWZ.jsonEval(C);D=B(C)}else{D=B()}if(!D){return}}A(E).hide();A("div.shadow").hide();if(A(E).data("mask")){A("#dialogBackground").hide()}else{if(A(E).data("id")){}}A("body").removeData(A(E).data("id"));A(E).trigger(DWZ.eventType.pageClear).remove()},closeCurrent:function(){this.close(A.pdialog._current)},checkTimeout:function(){var B=A(".dialogContent",A.pdialog._current);var C=DWZ.jsonEval(B.html());if(C&&C.statusCode==DWZ.statusCode.timeout){this.closeCurrent()}},maxsize:function(D){A(D).data("original",{top:A(D).css("top"),left:A(D).css("left"),width:A(D).css("width"),height:A(D).css("height")});A("a.maximize",D).hide();A("a.restore",D).show();var C=A(window).width();var B=A(window).height()-34;A(D).css({top:"0px",left:"0px",width:C+"px",height:B+"px"});A.pdialog._resizeContent(D,C,B)},restore:function(E){var B=A(E).data("original");var D=parseInt(B.width);var C=parseInt(B.height);A(E).css({top:B.top,left:B.left,width:D,height:C});A.pdialog._resizeContent(E,D,C);A("a.maximize",E).show();A("a.restore",E).hide();A.pdialog.attachShadow(E)},minimize:function(C){A(C).hide();A("div.shadow").hide();var B=A.taskBar.getTask(A(C).data("id"));A(".resizable").css({top:A(C).css("top"),left:A(C).css("left"),height:A(C).css("height"),width:A(C).css("width")}).show().animate({top:A(window).height()-60,left:B.position().left,width:B.outerWidth(),height:B.outerHeight()},250,function(){A(this).hide();A.taskBar.inactive(A(C).data("id"))})},_resizeContent:function(E,D,B){var C=A(".dialogContent",E);C.css({width:(D-12)+"px",height:B-A(".dialogHeader",E).outerHeight()-A(".dialogFooter",E).outerHeight()-6});C.find("[layoutH]").layoutH(C);A(".pageContent",E).css("width",(D-14)+"px");A(window).trigger(DWZ.eventType.resizeGrid)}}})(jQuery);