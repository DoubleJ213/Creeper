function initEnv(){$("body").append(DWZ.frag["dwzFrag"]);if($.browser.msie&&/6.0/.test(navigator.userAgent)){try{document.execCommand("BackgroundImageCache",false,true)}catch(A){}}if($.browser.msie){window.setInterval("CollectGarbage();",10000)}$(window).resize(function(){initLayout();$(this).trigger(DWZ.eventType.resizeGrid)});var B=$("#background,#progressBar");B.hide();$(document).ajaxStart(function(){B.show()}).ajaxStop(function(){B.hide()});$("#leftside").jBar({minW:150,maxW:700});if($.taskBar){$.taskBar.init()}navTab.init();if($.fn.switchEnv){$("#switchEnvBox").switchEnv()}if($.fn.navMenu){$("#navMenu").navMenu()}setTimeout(function(){initLayout();initUI();var C=$("div.tabsPageHeader");C.find(".tabsLeft").hoverClass("tabsLeftHover");C.find(".tabsRight").hoverClass("tabsRightHover");C.find(".tabsMore").hoverClass("tabsMoreHover")},10)}function initLayout(){var B=$(window).width()-(DWZ.ui.sbar?$("#sidebar").width()+10:34)-5;var A=$(window).height()-$("#header").height()-34;$("#container").width(B);$("#container .tabsPageContent").height(A-34).find("[layoutH]").layoutH();$("#sidebar, #sidebar_s .collapse, #splitBar, #splitBarProxy").height(A-5);$("#taskbar").css({top:A+$("#header").height()+5,width:$(window).width()});waterfall_list(B)}function getarraykey(A,B){for(k in A){if(A[k]==B){return k}}}function waterfall_list(B){var A=5;var K=$(".waterfall");var J=K.length;var G=K[0].offsetWidth+A;var E=[];var H=B/G|0;for(var F=0;F<J;F++){var C=K[F].offsetHeight;if(F<H){E[F]=C;K.eq(F).css("top",0);K.eq(F).css("left",F*G)}else{var D=Math.min.apply(null,E);var I=getarraykey(E,D);E[I]+=C+A;K.eq(F).css("top",D+A);K.eq(F).css("left",I*G)}window.onresize=function(){waterfall_list()}}}function init_AjaxTree(C,B){var A=$(C||document);$("div.panel",A).jPanel();$("table.table",A).jTable();$("table.list",A).cssTable();$("div.tabs",A).each(function(){var D=$(this);var E={};E.currentIndex=D.attr("currentIndex")||0;E.eventType=D.attr("eventType")||"click";D.tabs(E)});$("#ajax_tree",A).jTree(B);$("div.accordion",A).each(function(){var D=$(this);D.accordion({fillSpace:D.attr("fillSpace"),alwaysOpen:true,active:0})});$(":button.checkboxCtrl, :checkbox.checkboxCtrl",A).checkboxCtrl(A);if($.fn.combox){$("select.combox",A).combox()}$("a[target=ajax]",A).each(function(){$(this).click(function(F){var D=$(this);var G=D.attr("rel");if(G){Timer.cancelTag(D.attr("tag"));if(global_ws){global_ws.close();global_ws=null}var E=$("#"+G);E.loadUrl(D.attr("href"),{},function(){E.find("[layoutH]").layoutH()})}F.preventDefault()})})}function init_AjaxControlList(_box){var $p=$(_box||document);$("ul.tree",$p).jTree();$("div.accordion",$p).each(function(){var $this=$(this);$this.accordion({fillSpace:$this.attr("fillSpace"),alwaysOpen:true,active:0})});$("div.tabsHeader li, div.tabsPageHeader li, div.accordionHeader, div.accordion",$p).hoverClass("hover");$("a[target=navTab]",$p).each(function(){$(this).click(function(event){var $this=$(this);var title=$this.attr("title")||$this.text();var tabid=$this.attr("rel")||"_blank";var fresh=eval($this.attr("fresh")||"true");var external=eval($this.attr("external")||"false");var url=unescape($this.attr("href")).replaceTmById($(event.target).parents(".unitBox:first"));DWZ.debug(url);if(!url.isFinishedTm()){alertMsg.error($this.attr("warn")||DWZ.msg("alertSelectMsg"));return false}navTab.openTab(tabid,url,{title:title,fresh:fresh,external:external});event.preventDefault()})});$("a[target=ajax]",$p).each(function(){$(this).click(function(event){var $this=$(this);var rel=$this.attr("rel");if(rel){var $rel=$("#"+rel);$rel.loadUrl($this.attr("href"),{},function(){$rel.find("[layoutH]").layoutH()})}event.preventDefault()})});if($.fn.sortDrag){$("div.sortDrag",$p).sortDrag()}if($.fn.ajaxTodo){$("a[target=ajaxTodo]",$p).ajaxTodo()}if($.fn.dwzExport){$("a[target=dwzExport]",$p).dwzExport()}if($.fn.lookup){$("a[lookupGroup]",$p).lookup()}if($.fn.multLookup){$("[multLookup]:button",$p).multLookup()}if($.fn.suggest){$("input[suggestFields]",$p).suggest()}if($.fn.itemDetail){$("table.itemDetail",$p).itemDetail()}if($.fn.selectedTodo){$("a[target=selectedTodo]",$p).selectedTodo()}if($.fn.pagerForm){$("form[rel=pagerForm]",$p).pagerForm({parentBox:$p})}}function initUI(_box){var $p=$(_box||document);$("div.panel",$p).jPanel();$("table.table",$p).jTable();$("table.list",$p).cssTable();$("div.tabs",$p).each(function(){var $this=$(this);var options={};options.currentIndex=$this.attr("currentIndex")||0;options.eventType=$this.attr("eventType")||"click";$this.tabs(options)});$("ul.tree",$p).jTree();$("div.accordion",$p).each(function(){var $this=$(this);$this.accordion({fillSpace:$this.attr("fillSpace"),alwaysOpen:true,active:0})});$(":button.checkboxCtrl, :checkbox.checkboxCtrl",$p).checkboxCtrl($p);if($.fn.combox){$("select.combox",$p).combox()}if($.fn.xheditor){$("textarea.editor",$p).each(function(){var $this=$(this);var op={html5Upload:false,skin:"vista",tools:$this.attr("tools")||"full"};var upAttrs=[["upLinkUrl","upLinkExt","zip,rar,txt"],["upImgUrl","upImgExt","jpg,jpeg,gif,png"],["upFlashUrl","upFlashExt","swf"],["upMediaUrl","upMediaExt","avi"]];$(upAttrs).each(function(i){var urlAttr=upAttrs[i][0];var extAttr=upAttrs[i][1];if($this.attr(urlAttr)){op[urlAttr]=$this.attr(urlAttr);op[extAttr]=$this.attr(extAttr)||upAttrs[i][2]}});$this.xheditor(op)})}if($.fn.uploadify){$(":file[uploader]",$p).each(function(){var $this=$(this);var options={uploader:$this.attr("uploader"),script:$this.attr("script"),buttonImg:$this.attr("buttonImg"),cancelImg:$this.attr("cancelImg"),queueID:$this.attr("fileQueue")||"fileQueue",fileDesc:$this.attr("fileDesc"),fileExt:$this.attr("fileExt"),folder:$this.attr("folder"),fileDataName:$this.attr("name")||"file",auto:$this.attr("auto")||false,multi:true,onError:uploadifyError,onComplete:uploadifyComplete,onAllComplete:uploadifyAllComplete};if($this.attr("onComplete")){options.onComplete=DWZ.jsonEval($this.attr("onComplete"))}if($this.attr("onAllComplete")){options.onAllComplete=DWZ.jsonEval($this.attr("onAllComplete"))}if($this.attr("scriptData")){options.scriptData=DWZ.jsonEval($this.attr("scriptData"))}$this.uploadify(options)})}$("input[type=text], input[type=password], textarea",$p).addClass("textInput").focusClass("focus");$("input[readonly], textarea[readonly]",$p).addClass("readonly");$("input[disabled=true], textarea[disabled=true]",$p).addClass("disabled");$("input[type=text]",$p).not("div.tabs input[type=text]",$p).filter("[alt]").inputAlert();$("div.panelBar li, div.panelBar",$p).hoverClass("hover");$("div.button",$p).hoverClass("buttonHover");$("div.buttonActive",$p).hoverClass("buttonActiveHover");$("div.tabsHeader li, div.tabsPageHeader li, div.accordionHeader, div.accordion",$p).hoverClass("hover");$("form.required-validate",$p).each(function(){var $form=$(this);$form.validate({onsubmit:false,focusInvalid:false,focusCleanup:true,errorElement:"span",ignore:".ignore",invalidHandler:function(form,validator){var errors=validator.numberOfInvalids();if(errors){var message=DWZ.msg("validateFormError",[errors]);alertMsg.error(message)}}});$form.find("input[customvalid]").each(function(){var $input=$(this);$input.rules("add",{customvalid:$input.attr("customvalid")})})});if($.fn.datepicker){$("input.date",$p).each(function(){var $this=$(this);var opts={};if($this.attr("dateFmt")){opts.pattern=$this.attr("dateFmt")}if($this.attr("minDate")){opts.minDate=$this.attr("minDate")}if($this.attr("maxDate")){opts.maxDate=$this.attr("maxDate")}if($this.attr("mmStep")){opts.mmStep=$this.attr("mmStep")}if($this.attr("ssStep")){opts.ssStep=$this.attr("ssStep")}$this.datepicker(opts)})}$("a[target=navTab]",$p).each(function(){$(this).click(function(event){var $this=$(this);var title=$this.attr("title")||$this.text();var tabid=$this.attr("rel")||"_blank";var fresh=eval($this.attr("fresh")||"true");var external=eval($this.attr("external")||"false");var url=unescape($this.attr("href")).replaceTmById($(event.target).parents(".unitBox:first"));DWZ.debug(url);if(!url.isFinishedTm()){alertMsg.error($this.attr("warn")||DWZ.msg("alertSelectMsg"));return false}navTab.openTab(tabid,url,{title:title,fresh:fresh,external:external});event.preventDefault()})});$("a[target=dialog]",$p).each(function(){$(this).click(function(event){var $this=$(this);var title=$this.attr("title")||$this.text();var rel=$this.attr("rel")||"_blank";var options={};var w=$this.attr("width");var h=$this.attr("height");if(w){options.width=w}if(h){options.height=h}options.max=eval($this.attr("max")||"false");options.mask=eval($this.attr("mask")||"false");options.maxable=eval($this.attr("maxable")||"true");options.minable=eval($this.attr("minable")||"true");options.fresh=eval($this.attr("fresh")||"true");options.resizable=eval($this.attr("resizable")||"true");options.drawable=eval($this.attr("drawable")||"true");options.close=eval($this.attr("close")||"");options.param=$this.attr("param")||"";var url=unescape($this.attr("href")).replaceTmById($(event.target).parents(".unitBox:first"));DWZ.debug(url);if(!url.isFinishedTm()){alertMsg.error($this.attr("warn")||DWZ.msg("alertSelectMsg"));return false}$.pdialog.open(url,rel,title,options);return false})});$("a[target=ajax]",$p).each(function(){$(this).click(function(event){var $this=$(this);var rel=$this.attr("rel");if(rel){var $rel=$("#"+rel);$rel.loadUrl($this.attr("href"),{},function(){$rel.find("[layoutH]").layoutH()})}event.preventDefault()})});$("div.pagination",$p).each(function(){var $this=$(this);$this.pagination({targetType:$this.attr("targetType"),rel:$this.attr("rel"),totalCount:$this.attr("totalCount"),numPerPage:$this.attr("numPerPage"),pageNumShown:$this.attr("pageNumShown"),currentPage:$this.attr("currentPage")})});if($.fn.sortDrag){$("div.sortDrag",$p).sortDrag()}if($.fn.ajaxTodo){$("a[target=ajaxTodo]",$p).ajaxTodo()}if($.fn.dwzExport){$("a[target=dwzExport]",$p).dwzExport()}if($.fn.lookup){$("a[lookupGroup]",$p).lookup()}if($.fn.multLookup){$("[multLookup]:button",$p).multLookup()}if($.fn.suggest){$("input[suggestFields]",$p).suggest()}if($.fn.itemDetail){$("table.itemDetail",$p).itemDetail()}if($.fn.selectedTodo){$("a[target=selectedTodo]",$p).selectedTodo()}if($.fn.pagerForm){$("form[rel=pagerForm]",$p).pagerForm({parentBox:$p})}$("input[type=password]",$p).each(function(){$(this).keydown(function(e){if(e.ctrlKey){return e.keyCode!=86&&e.keyCode!=67}return true});$(this).bind("contextmenu",function(){return false});$(this).bind("selectstart",function(){return false})});$("[target_event]",$p).each(function(){var $ck_all=$(this);var ref_box=$ck_all.attr("target_event");$(this).bind("click",function(){$("input[name="+ref_box+"]",$p).each(function(){var checked=$ck_all.attr("checked")==undefined?false:true;$(this).attr("checked",checked)})});$("input[name="+ref_box+"]",$p).each(function(){$(this).bind("click",function(){var checked_len=$("input[name="+ref_box+"]:checked").length;var all_len=$("input[name="+ref_box+"]").length;if(checked_len!=all_len){$ck_all.attr("checked",false)}else{$ck_all.attr("checked",true)}})})});if(navigator.userAgent.toLowerCase().indexOf("ie")!=-1){$("textarea",$p).each(function(){var max_len=$(this).attr("maxlength");$(this).bind("propertychange",function(){if($(this).val().length>=max_len){var $value=$(this).val();$(this).val($value.substring(0,max_len))}});$(this).bind("input",function(){if($(this).val().length>=max_len){var $value=$(this).val();$(this).val($value.substring(0,max_len))}})})}};